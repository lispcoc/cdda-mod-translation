<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>jqueryのajaxのサンプル</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(function() {

            $("#button1").click(
                function() {
                    $("#span6").text("データ取得中です");

                    // 1.$.ajaxメソッドで通信を行います。
                    //  20行目のdataは、フォームの内容をserialize()している
                    //  →serialize()の内容は、cs1=custom1&cs2=custom2
                    $.ajax({
                        url: "https://script.googleusercontent.com/macros/echo", // 通信先のURL
                        type: "POST", // 使用するHTTPメソッド
                        data: $("#form1").serialize(), // 送信するデータ
                        dataType: "json", // 応答のデータの種類 
                        // (xml/html/script/json/jsonp/text)
                        timespan: 1000 // 通信のタイムアウトの設定(ミリ秒)

                        // 2. doneは、通信に成功した時に実行される
                        //  引数のdata1は、通信で取得したデータ
                        //  引数のtextStatusは、通信結果のステータス
                        //  引数のjqXHRは、XMLHttpRequestオブジェクト
                    }).done(function(data1, textStatus, jqXHR) {
                        $("#span1").text(jqXHR.status); //例：200
                        $("#span2").text(textStatus); //例：success

                        // 3. キーを指定して値を表示 
                        $("#span4").text(data1["form"]["cs1"]);

                        // 4. JavaScriptオブジェクトをJSONに変換
                        var data2 = JSON.stringify(data1);
                        console.log(data2); //コンソールにJSONが表示される

                        // 5.JSONをJavaScriptオブジェクトにし、
                        // キーを指定して値(httpbin.org)を表示
                        var data3 = JSON.parse(data2);
                        $("#span5").text(data3["headers"]["Host"]);

                        // 6. failは、通信に失敗した時に実行される
                    }).fail(function(jqXHR, textStatus, errorThrown) {
                        $("#span1").text(jqXHR.status); //例：404
                        $("#span2").text(textStatus); //例：error
                        $("#span3").text(errorThrown); //例：NOT FOUND

                        // 7. alwaysは、成功/失敗に関わらず実行される
                    }).always(function() {
                        $("#span6").text("complete");

                    });
                });
        });
    </script>
</head>

<body>
    <p>jqXHR.statusを表示：<span id="span1"></span></p>
    <p>textStatusを表示：<span id="span2"></span></p>
    <p>errorThrownを表示：<span id="span3"></span></p>
    <p>表示1：<span id="span4"></span></p>
    <p>表示2：<span id="span5"></span></p>
    <p>表示3：<span id="span6"></span></p>

    <p>ボタンを押すと通信が始まります</p>

    <form id="form1">
        <input type="button" id="button1" value="ボタン1">
        <p>テキストボックス１</p>
        <input type="text" name="user_content_key" value="hvBfHNr1IcvI6Gn84S281CiDV2IM9wi5g_IlFVrn8e4Qy-7A913CS21IELlAjLOKYdjlFr-sDpVkU2EI1AHRaQN5GouK8vTHm5_BxDlH2jW0nuo2oDemN9CCS2h10ox_1xSncGQajx_ryfhECjZEnNF7Hv-K8AaAJYBREFqUJpgbxQZuK9BmN3ZwW1Wjd9o3pUVGHLt8vwV4E1PPzh5HPUhicCO500zPbYdPuxG2pKksILwg1wI4DNz9Jw9Md8uu"
            maxlength="10">
        <p>テキストボックス２</p>
        <input type="text" name="lib" value="M14bxhUXzlfEb6AlFPu0_YhDvJCFarXH0" maxlength="10">
    </form>
</body>

</html>